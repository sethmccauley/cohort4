from openpyxl import load_workbook, Workbook
import os
from collections import defaultdict
import helpers



def test_xlsxBreaker():
    localFile = os.getcwd() + '/store_db.xlsx'
    assert len(helpers.breakIntoDict(localFile)['customers']) > 0
    assert len(helpers.breakIntoDict(localFile)['products']) > 0
    assert len(helpers.breakIntoDict(localFile)['invoices']) > 0
    assert len(helpers.breakIntoDict(localFile)['invoice_items']) > 0

def test_join():
    customers = {1: {'customer_id': 1, 'first_name': 'Victor', 'last_name': 'Morris', 'address': '217-271 Dolor Street'}, 2: {'customer_id': 2, 'first_name': 'Hamilton', 'last_name': 'Chase', 'address': 'P.O. Box 701, 7756 Risus. Ave'}, 3: {'customer_id': 3, 'first_name': 'Erich', 'last_name': 'Combs', 'address': 'P.O. Box 859, 1425 Nibh Avenue'}, 4: {'customer_id': 4, 'first_name': 'Yvette', 'last_name': 'Noble', 'address': '8492 Dis Rd.'}}
    invoices = {1: {'invoice_id': 1, 'customer_id': 1, 'invoice_date': '02/11/2019'}, 2: {'invoice_id': 2, 'customer_id': 2, 'invoice_date': '24/07/2019'}, 3: {'invoice_id': 3, 'customer_id': 1, 'invoice_date': '17/03/2021'}, 4: {'invoice_id': 4, 'customer_id': 4, 'invoice_date': '05/01/2020'}}
    invoice_items = {1: {'invoice_line_item_id': 1, 'invoice_id': 1, 'product_id': 17, 'qty': 2}, 2: {'invoice_line_item_id': 2, 'invoice_id': 1, 'product_id': 4, 'qty': 3}, 3: {'invoice_line_item_id': 3, 'invoice_id': 1, 'product_id': 17, 'qty': 3}, 4: {'invoice_line_item_id': 4, 'invoice_id': 1, 'product_id': 15, 'qty': 3}, 5: {'invoice_line_item_id': 5, 'invoice_id': 1, 'product_id': 17, 'qty': 4}, 6: {'invoice_line_item_id': 6, 'invoice_id': 1, 'product_id': 1, 'qty': 3}, 7: {'invoice_line_item_id': 7, 'invoice_id': 1, 'product_id': 8, 'qty': 1}, 8: {'invoice_line_item_id': 8, 'invoice_id': 1, 'product_id': 14, 'qty': 1}, 9: {'invoice_line_item_id': 9, 'invoice_id': 2, 'product_id': 12, 'qty': 4}, 10: {'invoice_line_item_id': 10, 'invoice_id': 2, 'product_id': 12, 'qty': 2}, 11: {'invoice_line_item_id': 11, 'invoice_id': 2, 'product_id': 17, 'qty': 4}, 12: {'invoice_line_item_id': 12, 'invoice_id': 2, 'product_id': 20, 'qty': 2}, 13: {'invoice_line_item_id': 13, 'invoice_id': 2, 'product_id': 10, 'qty': 2}, 14: {'invoice_line_item_id': 14, 'invoice_id': 2, 'product_id': 14, 'qty': 3}, 15: {'invoice_line_item_id': 15, 'invoice_id': 3, 'product_id': 20, 'qty': 3}, 16: {'invoice_line_item_id': 16, 'invoice_id': 3, 'product_id': 20, 'qty': 1}, 17: {'invoice_line_item_id': 17, 'invoice_id': 4, 'product_id': 3, 'qty': 3}, 18: {'invoice_line_item_id': 18, 'invoice_id': 4, 'product_id': 5, 'qty': 3}, 19: {'invoice_line_item_id': 19, 'invoice_id': 4, 'product_id': 15, 'qty': 3}, 20: {'invoice_line_item_id': 20, 'invoice_id': 4, 'product_id': 14, 'qty': 3}, 21: {'invoice_line_item_id': 21, 'invoice_id': 5, 'product_id': 16, 'qty': 3}, 22: {'invoice_line_item_id': 22, 'invoice_id': 5, 'product_id': 17, 'qty': 3}, 23: {'invoice_line_item_id': 23, 'invoice_id': 5, 'product_id': 6, 'qty': 3}, 24: {'invoice_line_item_id': 24, 'invoice_id': 5, 'product_id': 19, 'qty': 2}, 25: {'invoice_line_item_id': 25, 'invoice_id': 5, 'product_id': 1, 'qty': 1}, 26: {'invoice_line_item_id': 26, 'invoice_id': 5, 'product_id': 11, 'qty': 3}, 27: {'invoice_line_item_id': 27, 'invoice_id': 5, 'product_id': 9, 'qty': 1}, 28: {'invoice_line_item_id': 28, 'invoice_id': 5, 'product_id': 12, 'qty': 4}, 29: {'invoice_line_item_id': 29, 'invoice_id': 5, 'product_id': 1, 'qty': 1}, 30: {'invoice_line_item_id': 30, 'invoice_id': 6, 'product_id': 15, 'qty': 4}, 31: {'invoice_line_item_id': 31, 'invoice_id': 6, 'product_id': 4, 'qty': 3}, 32: {'invoice_line_item_id': 32, 'invoice_id': 6, 'product_id': 10, 'qty': 3}, 33: {'invoice_line_item_id': 33, 'invoice_id': 7, 'product_id': 9, 'qty': 4}, 34: {'invoice_line_item_id': 34, 'invoice_id': 7, 'product_id': 5, 'qty': 2}, 35: {'invoice_line_item_id': 35, 'invoice_id': 7, 'product_id': 5, 'qty': 3}, 36: {'invoice_line_item_id': 36, 'invoice_id': 7, 'product_id': 5, 'qty': 3}, 37: {'invoice_line_item_id': 37, 'invoice_id': 7, 'product_id': 2, 'qty': 1}, 38: {'invoice_line_item_id': 38, 'invoice_id': 7, 'product_id': 14, 'qty': 2}, 39: {'invoice_line_item_id': 39, 'invoice_id': 8, 'product_id': 10, 'qty': 4}, 40: {'invoice_line_item_id': 40, 'invoice_id': 9, 'product_id': 17, 'qty': 1}, 41: {'invoice_line_item_id': 41, 'invoice_id': 9, 'product_id':
12, 'qty': 1}, 42: {'invoice_line_item_id': 42, 'invoice_id': 9, 'product_id': 15, 'qty': 3}, 43: {'invoice_line_item_id': 43, 'invoice_id': 9, 'product_id': 6, 'qty': 4}, 44: {'invoice_line_item_id': 44, 'invoice_id': 10, 'product_id': 8, 'qty': 1}, 45: {'invoice_line_item_id': 45, 'invoice_id': 10, 'product_id': 14, 'qty': 3}, 46: {'invoice_line_item_id': 46, 'invoice_id': 10, 'product_id': 16, 'qty': 4}, 47: {'invoice_line_item_id': 47, 'invoice_id': 10, 'product_id': 4, 'qty': 3}, 48: {'invoice_line_item_id': 48, 'invoice_id': 10, 'product_id': 19, 'qty': 2}, 49: {'invoice_line_item_id': 49, 'invoice_id': 11, 'product_id': 19, 'qty': 1}, 50: {'invoice_line_item_id': 50, 'invoice_id': 11, 'product_id': 15, 'qty': 1}, 51: {'invoice_line_item_id': 51, 'invoice_id': 11, 'product_id': 17, 'qty': 2}, 52: {'invoice_line_item_id': 52, 'invoice_id': 12, 'product_id': 16, 'qty': 2}, 53: {'invoice_line_item_id': 53, 'invoice_id': 12, 'product_id': 13, 'qty': 4}, 54: {'invoice_line_item_id': 54, 'invoice_id': 12, 'product_id': 16, 'qty': 1}, 55: {'invoice_line_item_id': 55, 'invoice_id': 12, 'product_id': 5, 'qty': 1}, 56: {'invoice_line_item_id': 56, 'invoice_id': 13, 'product_id': 10, 'qty': 1}, 57: {'invoice_line_item_id': 57, 'invoice_id': 13, 'product_id': 15, 'qty': 3}, 58: {'invoice_line_item_id': 58, 'invoice_id': 13, 'product_id': 4, 'qty': 2},
59: {'invoice_line_item_id': 59, 'invoice_id': 13, 'product_id': 19, 'qty': 2}, 60: {'invoice_line_item_id': 60, 'invoice_id': 13, 'product_id': 16, 'qty': 4}, 61: {'invoice_line_item_id': 61, 'invoice_id': 13, 'product_id': 7,
'qty': 4}, 62: {'invoice_line_item_id': 62, 'invoice_id': 13, 'product_id': 9, 'qty': 1}, 63: {'invoice_line_item_id': 63, 'invoice_id': 13, 'product_id': 6, 'qty': 1}, 64: {'invoice_line_item_id': 64, 'invoice_id': 13, 'product_id': 9, 'qty': 3}, 65: {'invoice_line_item_id': 65, 'invoice_id': 13, 'product_id': 5, 'qty': 1}, 66: {'invoice_line_item_id': 66, 'invoice_id': 14, 'product_id': 5, 'qty': 4}, 67: {'invoice_line_item_id': 67, 'invoice_id': 14, 'product_id': 1, 'qty': 4}, 68: {'invoice_line_item_id': 68, 'invoice_id': 14, 'product_id': 12, 'qty': 3}, 69: {'invoice_line_item_id': 69, 'invoice_id': 14, 'product_id': 17, 'qty': 2}, 70: {'invoice_line_item_id': 70, 'invoice_id': 14, 'product_id': 18, 'qty': 2}, 71: {'invoice_line_item_id': 71, 'invoice_id': 14, 'product_id': 20, 'qty': 1}, 72: {'invoice_line_item_id': 72, 'invoice_id': 15, 'product_id': 15, 'qty': 3}, 73: {'invoice_line_item_id': 73, 'invoice_id': 15, 'product_id': 12, 'qty': 4}, 74: {'invoice_line_item_id': 74, 'invoice_id': 15, 'product_id': 11, 'qty': 4}, 75: {'invoice_line_item_id': 75, 'invoice_id': 15, 'product_id': 17, 'qty': 1}, 76: {'invoice_line_item_id': 76, 'invoice_id': 15, 'product_id': 3, 'qty': 2}, 77: {'invoice_line_item_id': 77, 'invoice_id': 15, 'product_id': 9, 'qty': 2}, 78: {'invoice_line_item_id': 78, 'invoice_id': 15, 'product_id': 15, 'qty': 1}, 79: {'invoice_line_item_id': 79, 'invoice_id': 16, 'product_id': 16, 'qty': 2}, 80: {'invoice_line_item_id': 80, 'invoice_id': 16, 'product_id': 12, 'qty': 3}, 81: {'invoice_line_item_id': 81, 'invoice_id': 16, 'product_id': 19, 'qty': 1}, 82: {'invoice_line_item_id': 82, 'invoice_id': 16, 'product_id': 12, 'qty': 4}, 83: {'invoice_line_item_id': 83, 'invoice_id': 16, 'product_id': 3, 'qty': 2}, 84: {'invoice_line_item_id': 84, 'invoice_id': 17, 'product_id': 13, 'qty': 4}, 85: {'invoice_line_item_id': 85, 'invoice_id': 17, 'product_id': 4, 'qty': 4}, 86: {'invoice_line_item_id': 86, 'invoice_id': 17, 'product_id': 19, 'qty': 1}, 87: {'invoice_line_item_id': 87, 'invoice_id': 17,
'product_id': 5, 'qty': 2}, 88: {'invoice_line_item_id': 88, 'invoice_id': 18, 'product_id': 3, 'qty': 3}, 89: {'invoice_line_item_id': 89, 'invoice_id': 18, 'product_id': 19, 'qty': 1}, 90: {'invoice_line_item_id': 90, 'invoice_id': 18, 'product_id': 6, 'qty': 3}, 91: {'invoice_line_item_id': 91, 'invoice_id': 19, 'product_id': 15, 'qty': 2}, 92: {'invoice_line_item_id': 92, 'invoice_id': 19, 'product_id': 15, 'qty': 1}, 93: {'invoice_line_item_id': 93, 'invoice_id': 20, 'product_id': 3, 'qty': 4}, 94: {'invoice_line_item_id': 94, 'invoice_id': 20, 'product_id': 1, 'qty': 1}, 95: {'invoice_line_item_id': 95, 'invoice_id': 20, 'product_id': 16, 'qty': 4}, 96: {'invoice_line_item_id': 96, 'invoice_id': 20, 'product_id': 14, 'qty': 1}, 97: {'invoice_line_item_id': 97, 'invoice_id': 20, 'product_id': 9, 'qty': 4}, 98: {'invoice_line_item_id': 98, 'invoice_id': 20, 'product_id': 9, 'qty': 4}, 99: {'invoice_line_item_id': 99, 'invoice_id': 20, 'product_id': 19, 'qty': 4}, 100: {'invoice_line_item_id': 100, 'invoice_id': 20, 'product_id': 14, 'qty': 2}}

    # Total Number of Invoices for all Customers
    merged = helpers.innerJoin(customers, invoices, 'customer_id')
    assert len(merged) == 4
    # Number of Invoices for Customer ID: 1
    merged = helpers.innerJoin(customers, invoices, 'customer_id', 1)
    assert len(merged) == 2
    # Total number of Unique Invoice Line Items for Invoices of Customer ID: 1 with Invoice ID: 1
    total_items = helpers.innerJoin(merged, invoice_items, 'invoice_id', 1)
    assert len(total_items) == 8
    # Total number of Unique Invoice Line Items for Invoices of Customer ID: 1 with Invoice ID: 3
    total_items = helpers.innerJoin(merged, invoice_items, 'invoice_id', 3)
    assert len(total_items) == 2

    tester = helpers.innerJoin(invoices,customers, 'customer_id')
    tester = helpers.innerJoin(tester,invoice_items, 'invoice_id', 1)
    print(tester)